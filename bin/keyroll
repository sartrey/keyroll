#!/usr/bin/env node

'use strict'

const keyroll = require('../')
const { utility, command } = require('../cli')

function space(n) {
  return ' '.repeat(n)
}

/**
 * output help list
 */
function showHelp() {
  console.log('\n/// KEYROLL ///\n')
  console.log('Usage\n')
  console.log(space(2) + 'keyroll <action> [more query] \n')
  console.log('Guide\n')
  console.log(space(2) + 'use [root]')
  console.log(space(2) + 'get [uuid] [tags]')
  console.log(space(2) + 'set [uuid] <data / file>')
  console.log(space(2) + 'tag <uuid> <tags>')
  console.log()
}

/**
 * output version
 */
function showSelf() {
  var self = require('../package.json')
  console.log(self.version)
}

/**
 * main cycle
 */
(async function main() {
  var params = utility.parseParams(process.argv.filter(Boolean))
  console.log(params)
  var { action, search, enable } = params
  if (!command[action]) return showHelp()
  try {
    var volumn = await utility.getCurrentVolumn()
    if (search.tags) search.tags = utility.splitTagText(search.tags)
    console.log(search.tags)
    await command[action](volumn, search)
  } catch (error) {
    console.error(error)
  }
}())
