#!/usr/bin/env node

'use strict'

const keyroll = require('../')
const { utility, command, console } = require('../cli')

function space(n) {
  return ' '.repeat(n)
}

/**
 * output help list
 */
function showHelp() {
  var fs = require('fs')
  var path = require('path')
  var help = fs.readFileSync(path.join(__dirname, 'guide.txt'), 'utf8')
  console.log(help)
}

/**
 * output version
 */
function showSelf() {
  var self = require('../package.json')
  console.log(self.version)
}

/**
 * main cycle
 */
(async function main() {
  var params = utility.parseParams(process.argv.filter(Boolean))
  var { action, search, enable } = params
  if (enable.verbose) console.log(params)
  if (!command[action]) return showHelp()
  try {
    if (search.tags) search.tags = utility.splitTagText(search.tags)
    var volumn = await utility.getCurrentVolumn()
    if (volumn) {
      await command[action](volumn, search, enable)
    }
  } catch (error) {
    console.logger.halt(error.message)
    if (enable.verbose) console.error(error)
  }
}())
